!function(t,e){var o=this,n=!1,a={};this.totalWait=0;this.totalWaitSinceChange=0;this.totalSongs=0;this.quoteEscape=function(t){return'"'+t.replace('"','""')+'"'};this.scrape=function(){for(var t=document.querySelectorAll(".song-table tr.song-row"),e=0;e<t.length;e++){var n,l=t[e],i=l.querySelectorAll('td[data-col="title"] .column-content')[0].textContent,s=l.querySelectorAll('td[data-col="artist"] .column-content')[0].textContent,r=l.querySelectorAll('td[data-col="album"] .column-content')[0].textContent,c=l.querySelectorAll('td[data-col="duration"] span')[0].textContent;if("ivy"==o.format)n=s.replace("-"," ").trim()+" - "+i.replace(/(.+?)\s*[\(\[].+[\)\]]\s*$/,"$1").trim();else if("m3u"==o.format){var u,d=c.split(":");if(3===d.length)u=3600*parseInt(d[0],10)+60*parseInt(d[1],10)+parseInt(d[2],10);else if(2==d.length)u=60*parseInt(d[0],10)+parseInt(d[1],10);else u=-1;n="#EXTINF:"+u+","+s.replace("-"," ").trim()+" - "+i.replace(/(.+?)\s*[\(\[].+[\)\]]\s*$/,"$1").trim()+"\n"+r.trim()+"/"+s.replace("-"," ").trim()+" - "+i.replace(/(.+?)\s*[\(\[].+[\)\]]\s*$/,"$1").trim()+".mp3"}else n=quoteEscape(s)+","+quoteEscape(i)+","+quoteEscape(r)+","+quoteEscape(c);if(!a.hasOwnProperty(n)){o.totalSongs++;o.totalWaitSinceChange=0;a[n]={artist:s,title:i,album:r,duration:c}}}};this.download=function(){if(!n){n=!0;var t,e,l,i,s;t="";for(var r in a)t+=r+"\n";if("ivy"==o.format){i="text";s="playlist.txt"}else if("m3u"==o.format){t="#EXTM3U\n"+t;i="text/m3u";s="playlist.m3u"}else{i="text/csv";s="playlist.csv"}e=document.createElement("a");l=new Blob([t],{type:i});e.href=window.URL.createObjectURL(l);e.download=s;e.click()}};this.scrollAll=function(){o.scrape();if(!n){var e=t>=0?1e3*t-o.totalWait:9e3-o.totalWaitSinceChange;if(e>0){o.totalWait+=50;o.totalWaitSinceChange+=50;o.statusBox.innerHTML="Download in "+Math.round(e/1e3)+" seconds; Songs: "+o.totalSongs;setTimeout(function(){o.scrollAll()},50)}else download()}};this.begin=function(){o.dialog.close();var t=document.getElementById("playlist-format");o.format=t.options[t.selectedIndex].value;o.scrape();o.scrollAll();return!1};o.totalSongs=0;o.statusBox=document.createElement("div");o.statusBox.style.position="fixed";o.statusBox.style.bottom="0";o.statusBox.style.right="0";o.statusBox.style.background="#CCC";o.statusBox.style.zIndex=999999;o.statusBox.innerHTML="Songs: 0";document.body.appendChild(o.statusBox);if("prompt"===e){o.dialog=document.createElement("dialog");o.dialog.innerHTML='<form onsubmit="return self.begin();"><strong>Select Format:</strong><select id="playlist-format"><option value="m3u">M3U (Generic, soundiiz.com, etc.)</option><option value="csv">CSV (Generic CSV)</option><option value="ivy">IVY (ivyishere.org)</option></select> <input type="submit" value="Begin"/></form>';document.body.appendChild(o.dialog);o.dialog.showModal()}else o.begin()}(-1,"prompt");
